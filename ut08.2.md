# UT8.2 AdministraciÃ³n de Windows: usuarios, grupos y permisos

## Usuarios y grupos locales

```note
ðŸ’¡ Un **usuario** es una persona identificable que puede usar un SO.
```

```note
ðŸ’¡ Un **grupo** es un conjunto de usuarios a los que se les asocian las mismas reglas.
```

Las versiones de Windows permiten la gestiÃ³n de **usuarios** y **grupos locales**, mientras que las versiones Windows Server ademÃ¡s, las de **usuarios** y **grupos de Dominio** (en red) que veremos mÃ¡s adelante.

Windows necesita que un usuario se valide ante el sistema para poder usarlo. Este tiene que haber sido, ademÃ¡s, dado de alta previamente por el Ãºnico usuario que, en principio, tiene privilegios sobre el equipo: **el Administrador***.*

Una vez creado el usuario, este podrÃ¡ iniciar sesiÃ³n en el equipo de forma local, y, si es el caso, tambiÃ©n de forma remota (desde un **Dominio**).

Se entiende por tanto como **usuario o grupo local** la configuraciÃ³n personalizada que permite iniciar sesiÃ³n de trabajo en un equipo local.

```note
ðŸ’¡ Una **cuenta de usuario** es una colecciÃ³n de informaciÃ³n que indica al SO los archivos y carpetas a los que puede tener acceso un determinado usuario del equipo, los cambios que puede realizar en Ã©l asÃ­ como sus preferencias personales.
```

En Windows existen dos tipos de **cuentas de usuario local**:

-   **Cuenta de usuario local estÃ¡ndar**: Tiene privilegios limitados, se puede usar la mayorÃ­a de los programas instalados en el equipo, pero no se puede instalar o desinstalar software ni hardware, eliminar archivos que son necesarios para que el equipo funcione, o cambiar opciones de configuraciÃ³n que afecten a otros usuarios.
-   **Cuenta de administrador**: Tiene el mÃ¡ximo control sobre el equipo local y sÃ³lo se debe usar cuando se lleven a cabo tareas de administraciÃ³n que requieran los privilegios del administrador. Este tipo de cuenta permite realizar cambios que afectan a otros usuarios. Son tareas fundamentales de los administradores las relativas a configuraciÃ³n de seguridad, instalaciÃ³n de software, hardware, etc.

La cuenta de **Invitado** era un tipo de cuenta con derechos muy limitados que en Windows 10 se ha terminado por eliminar por motivos de seguridad.

```note
Cada cuenta de usuario se identifican con un **SID** (Security Identifier) o Identificador de Seguridad. Se trata de un nÃºmero de identificaciÃ³n Ãºnico para cada usuario. 
```

Es como el DNI de cada usuario, Windows identifica internamente los usuarios a travÃ©s de su SID y no por su nombre.

Para ver todos los **SID** del sistema se utiliza de nuevo el comando **WMIC**:

![](media/dfbbe51a4f7047e08db2523c59393d24.jpeg)

```note
ðŸ’¡ Un **grupo de usuarios** es un conjunto de cuentas de usuario que tienen en comÃºn las mismas reglas y derechos de seguridad.
``` 

Los **grupos** en Windows proporcionan la posibilidad de otorgar permisos a tipos de usuarios con caracterÃ­sticas similares. Si un usuario es miembro de un grupo con acceso a un recurso, ese usuario en particular puede acceder al mismo recurso que estos. Los grupos de usuarios locales se nombran como *Equipo\\Nombre_grupo.*

Windows emplea los siguientes tipos de grupos:

-   **Grupos locales:** Definidos en un equipo local y usados solo en dicho equipo local.
-   **Grupos de seguridad:** Pueden tener descriptores de seguridad asociados. Se utiliza un servidor Windows para definir grupos de seguridad en dominios.
-   **Grupos de distribuciÃ³n:** Se utilizan como lista de distribuciÃ³n de correo electrÃ³nico. No pueden usar descriptores de seguridad.
-   **Grupos creados por nosotros**: SegÃºn nuestras necesidades podremos crear grupos con un nombre y funciÃ³n u otro.

Al instalar Windows se crean por defecto varios **grupos de usuarios** predefinidos en el sistema:

-   Administradores.
-   Operadores de copia de seguridad.
-   Operadores criptogrÃ¡ficos.
-   Lectores del registro de eventos.
-   Invitados.
-   Operadores de configuraciÃ³n de red.
-   Usuarios del registro de rendimiento.
-   Usuarios del monitor del sistema.
-   Usuarios avanzados\*.
-   Usuarios autenticados.
-   Usuarios de escritorio remoto.
-   Duplicadores.
-   Usuarios\*.

Podemos crear, borrar y modificar cuentas de usuario y grupos locales en Windows desde varios sitios distintos del SO, con distintas opciones:

1.  **Cuentas** desde la configuraciÃ³n de Windows (poco Ãºtil)
2.  **Cuentas de usuario** desde Panel de Control.
3.  **GestiÃ³n de cuentas de usuario** desde *Herramientas Administrativas \> AdministraciÃ³n de equipos.*
4.  Ventana del **gestor de usuarios.**
5.  Desde la **consola de comandos** (CMD)

![](media/dac7ffc5fb8697f3ae9231362dc8caa7.jpeg)
![](media/b16893f3acbe8513daec135d08017a11.jpeg)

Desde **administraciÃ³n de equipos** en cambio, se pueden gestionar ademÃ¡s de usuarios, grupos, perfiles y propiedades de forma detallada:

![](media/1f50aac47764af6ae74c7ada386e2f37.jpeg)

Al usuario **Administrador** no hay que darlo de alta, ya que se crea automÃ¡ticamente. Tampoco se puede borrar, aunque sÃ­ personalizar. Es el que suele dar de alta a los demÃ¡s usuarios o grupos, el que los borra y el que los modifica.

Para dar de alta un nuevo usuario local en el equipo que tenemos, tendremos que ir al *Administrador de equipos*. Desde allÃ­, y seleccionando la opciÃ³n *Usuarios,* podremos ver que en la ventana de la derecha se despliega la lista de usuarios que tiene creado el sistema nada mÃ¡s instalarlo.

Para **dar de alta o aÃ±adir** a un nuevo usuario local desde el administrador de equipos el Ãºnico que podrÃ¡ hacerlo serÃ¡ el Administrador del equipo o un usuario con privilegios suficientes para realizar este tipo de operaciones.

![](media/e2247ddc57d7e0a739dde49ee6ab4dc9.png)

Para que un sistema sea seguro y no pueda acceder ningÃºn usuario no autorizado, es prÃ¡cticamente obligatorio, que todos los usuarios del sistema introduzcan una **contraseÃ±a** para loguearse. Las contraseÃ±as se gestionan en la misma pantalla en la que se da de alta el usuario. Las opciones son las siguientes:

-   **El usuario debe cambiar la contraseÃ±a en el siguiente inicio de sesiÃ³n**. Si activamos esta casilla, hayamos introducido o no contraseÃ±a, la primera vez que el usuario se conecte, el sistema le pedirÃ¡ obligatoriamente que cambie la contraseÃ±a.
-   **El usuario no puede cambiar la contraseÃ±a**. El usuario podrÃ¡ iniciar sesiÃ³n con una contraseÃ±a en blanco o no, pero no podrÃ¡ cambiarla en ningÃºn momento.
-   **La contraseÃ±a nunca expira**. Si no marcamos esta casilla, la contraseÃ±a caducarÃ¡, es decir, expirarÃ¡ a los 42 dÃ­as por defecto.
-   **Cuenta deshabilitada**. Esta opciÃ³n se utiliza para no eliminar las credenciales del ordenador de un usuario que no queremos que se conecte.

Otra forma de gestionar usuarios mÃ¡s simplificada si cabe, es abriendo la ventana del **gestor de usuarios** o ejecutando el comando **NETPLWIZ**

![](media/95a52f79898f1f8b4acecea6a026702d.png)

### Control de cuentas de usuario (UAC)

El **UAC** (*User Account Control*) o **control de cuentas de usuario** es una caracterÃ­stica de seguridad que se encarga de notificar alertas de seguridad del sistema al usuario. Lanza mensajes de alerta cuando se quiere realizar alguna acciÃ³n que influya en el sistema, tal como la instalaciÃ³n de determinados programas, la modificaciÃ³n del registro de Windows, la creaciÃ³n de servicios, etc y que requieren privilegios de usuarios con permiso de administrador.

![](media/ef36532bc11cb2455716b16f8e49929c.png)

El nivel de alertas del **UAC** se puede ajustar para que sea mÃ¡s o menos agresivo o incluso desactivarlo (lo cual no es nunca recomendable).

### GestiÃ³n de usuarios desde la consola

```tip
A la hora de gestionar **usuarios** desde consola existe un comando especÃ­fico para ello: **NET USER**
```

La sintaxis del comando: 

        NET USER usuario [contraseÃ±a] [parÃ¡metros]

NET USER nombreusuario: Devuelve toda la informaciÃ³n asociada a la cuenta del usuario proporcionado.

NET USER nombreusuario contraseÃ±a: Asociar una contraseÃ±a al usuario indicado.

NET USER nombreusuario /ACTIVE:YES\|NO: activar o desactivar la cuenta del usuario especificado.

NET USER nombreusuario contraseÃ±a /ADD: AÃ±ade el usuario indicado con la contraseÃ±a facilitada. Parecida a la anterior, pero esta solo sirve para asociar una contraseÃ±a a un usuario ya existente en Windows.

NET USER nombreusuario /DELETE: Elimina el usuario y todo lo relacionado con Ã©l en lo que se refiere a configuraciÃ³n. Los cambios no son reversibles.

-   Para ver los usuarios en el sistema actualmente:

        NET USER

-   Para agregar un usuario:

        NET USER nombreusuario /ADD

-   Para agregar un usuario con contraseÃ±a:

        NET USER nombreusuario contraseÃ±a /ADD

-   Para eliminar un usuario:

        NET USER nombreusuario * /DELETE

-   Para activar o desactivar una cuenta de usuario:

        NET USER nombreusuario active:yes|no

### GestiÃ³n de grupos desde la consola

A la hora de gestionar **grupos** se utiliza una variante del anterior comando denominada: **NET LOCALGROUP**

La sintaxis del comando: 

        NET LOCALGROUP usuario [parÃ¡metros]

-  Para ver los grupos locales registrados del sistema:

        NET LOCALGROUP

-   Para agregar un nuevo grupo:

        NET LOCALGROUP nombregrupo /ADD

-   Para eliminar un grupo existente:

        NET LOCALGROUP nombregrupo /DELETE

-   Para agregar un usuario a un grupo:

        NET LOCALGROUP nombregrupo nombreusuario /ADD

## Permisos NTFS

El sistema de **permisos** de carpetas y usuarios en Windows es relativamente complejo y es una caracterÃ­stica de su sistema de archivos **NTFS**.

Cada carpeta en Windows tiene un **propietario**, que es su creador, ya sea el propio SO (*SYSTEM*), un instalador (*TrustedInstaller*) o un usuario concreto (*javier*).

Cada carpeta o archivo puede tener a su vez varios usuarios o grupos de usuarios a los cuales se les puede asignar determinados permisos.

Dichos **permisos bÃ¡sicos** en Windows son:

- Control total

- Modificar

- Lectura y ejecuciÃ³n

- Mostrar el contenido de la carpeta

- Ejecutar

Usamos los permisos **NTFS** para especificar:

-   Usuarios y grupos que acceden a archivos y carpetas
-   Acciones que puedan realizar sobre ellos
-   Cada permiso tendrÃ¡ 3 posibles estados:

    - Conceder 
    - Denegar
    - Dejar en blanco, con lo que decidirÃ¡ otra regla


-   Los permisos se aplicarÃ¡n a dos niveles:
    -   A nivel de carpeta
    -   A nivel de archivos.


    ![](media/5254a437de0bcacd0485a7c18dadd478.jpeg)

### Listas ACL

Para asignar permisos en Windows, se utilizan Listas de control de acceso o **ACLs.**

Todos los objetos de tipo fichero o carpeta se encuentran protegidos por un **SD**

```note
ðŸ’¡ Las **ACL** (*Access Control Lists*), son listas de condiciones que poseen los descriptores de seguridad (SD) y que permiten designar permisos de acceso a cualquier elemento del sistema o directorio en general.
```

La **lista ACL** contiene un listado de todas las cuentas de usuario, grupos y equipos a los que se ha concedido acceso al archivo o carpeta, y el tipo de acceso concedido.

![](media/66ad770116e30a91b658441f291156f9.png)

Para que un usuario pueda acceder a un archivo o carpeta:

-   La lista ACL debe contener una entrada, denominada entrada de control de acceso (Access Control Entry, **ACE**), para la cuenta de usuario, grupo o equipo al que pertenece el usuario.
-   La entrada debe permitir especÃ­ficamente el tipo de acceso solicitado por el usuario para que Ã©ste pueda tener acceso al archivo o carpeta.
-   Si no existe ninguna entrada ACE en la lista ACL, Windows denegarÃ¡ al usuario el acceso al recurso.

![](media/611acc48f2049d7487b15cf7c081ea7b.jpeg)

### Propietario carpeta o archivo


Para cambiar el **propietario** de una carpeta o archivo haremos clic en Cambiar siendo usuario administrador. Desde la ventana que se abrirÃ¡ escribiremos el nombre o grupo de usuarios a los que asignar la propiedad:

![](media/1cf08bfe9abdc629c600ab3a02f4ec3b.png)
![](media/96068d6126776a8742a1fa760bbf78e7.png)

El orden de interpretaciÃ³n de los permisos, en caso de conflicto, es el siguiente:

-   Accesos denegados explÃ­citos (*DENY ONLY*).
-   Accesos autorizados explÃ­citos (*ALLOW ONLY*).
-   Accesos denegados heredados.
-   Accesos autorizados heredados.

```warning
Si hay por tanto permisos denegados explÃ­citos y a su vez autorizados, la anulaciÃ³n siempre tendrÃ¡ preferencia sobre las demÃ¡s.
```

En caso de querer acceder a una carpeta en la cual no tenemos permisos o no somos administradores aparecerÃ¡ el siguiente mensaje.

![](media/681ccbc9703ff0474e1867b575617578.png)

Para modificar los permisos de una carpeta se debe entrar en sus propiedades dentro de la pestaÃ±a **seguridad** y a continuaciÃ³n en **Editar** para el usuario buscado.

En caso de no tener permisos en la carpeta y querer cambiar su **propietario** o editar permisos especiales desde un menÃº mucho mÃ¡s complejo, seleccionaremos **opciones avanzadas**:

![](media/1cf08bfe9abdc629c600ab3a02f4ec3b.png)

Existen otra serie de permisos para usos especÃ­ficos, son los llamados permisos especiales:

-   Atravesar carpeta/Ejecutar archivo
-   Mostrar carpeta/Leer datos
-   Leer atributos
-   Leer atributos extendidos
-   Crear archivos/Escribir datos
-   Crear carpetas/Anexar datos
-   Escribir atributos
-   Escribir atributos extendidos
-   Eliminar subcarpetas y archivos
-   Eliminar
-   Permisos de lectura
-   Cambiar permisos
-   Tomar posesiÃ³n

![](media/647101c6fbb7eff0051503ef9004a3ff.png)

## Herencia de permisos

La **herencia de permisos** puede resultar confusa o compleja en Windows. 

ðŸ’¡ Al crear un archivo o carpeta en un volumen NTFS ese objeto **hereda automÃ¡ticamente los permisos de su carpeta contenedora.**

De la misma forma cuando asignamos permisos a una carpeta contenedora, los permisos se propagan automÃ¡ticamente hacia los archivos y subcarpetas contenidas en el recurso.

![](media/c333eafea6bfa8ca3d5a3ce08ce324ac.jpeg)

-   Los permisos de NTFS son acumulativos.
-   Los permisos de archivo son independientes de los permisos de carpeta.
-   El permiso denegar invalida otros permisos lo cual a veces es confuso.

![](media/87074af894d921fff1b894914cfef285.jpeg)

Se puede comprobar de forma sencilla la herencia de una carpeta o archivo en la columna â€œ*Heredada deâ€* de opciones avanzadas en las propiedades de la carpeta:

![](media/bc07a11679411d6f71101bdca38d8291.png)

ðŸ’¡ Si queremos anular dicho comportamiento por defecto haremos clic en el botÃ³n Deshabilitar herencia y convertiremos los permisos heredados en permisos explÃ­citos.

### Comandos gestiÃ³n de permisos

```tip
Podemos usar el comando **ICACLS** para modificar permisos de sistema de archivos.
```

**NTFS** en un equipo que estÃ¡ ejecutando un SO Windows. ICACLS nombre_objeto [modificadores] [opciones] Donde modificadores puede ser:

    /GRANT: Conceder permisos
    /DENY: Denegar permisos
    /SAVE: Guarda las ACLS de los objetos en el fichero que se le indique.
    /RESTORE: Recupera las ACLS almacenadas en el archivo especificado.
    /SETOWNER: Cambiar el propietario de los objetos que se le especifiquen.
    /INHERITANCE: Habiltar/deshabilitar herencia 
    
Y opciones puede ser:

    /T Indicar que las operaciones se realicen recursivamente
    /C Continuar las operaciones aunque encuentre errores

MÃ¡scara de derechos simples sobre ficheros:

- N sin acceso

- F acceso completo (total)

- M modificar acceso

- RX acceso de lectura y ejecuciÃ³n

- R acceso de solo lectura

-  W acceso de solo escritura

-  D acceso de eliminaciÃ³n

```warning
En caso de conflicto entre usuario, grupos y sus reglas, **las reglas de prohibiciÃ³n tienen mayor prioridad** que las que permitan el acceso.
```

Los **derechos de herencia** pueden preceder a cualquier forma y se aplican solo a directorios:

- O herencia de objeto

- NP no propagar herencia

- CI herencia de contenedor

- I permiso heredado del contenedor principal

- OI solo herencia

Veremos a continuaciÃ³n algunos ejemplos prÃ¡cticos:

-   Para permitir al usuario Victor permitir modificar (**M**) el contenido de la carpeta C:\\USERS\\JAVIER\\DIRECTORIO

        ICACLS C:\Users\Javier\Proyecto /GRANT VICTOR:M


-   Para otorgar al grupo PROFESORES permiso de Control total (**F**) y aplicar toda la configuraciÃ³n a las subcarpetas:

        ICACLS C:\ejercicios /GRANT PROFESORES:F /C /T

-   Eliminar el control total del usuario Ana del contenido de una carpeta indicado y subcarpetas:

        ICACLS D:\Documentos /REMOVE ANA:F /C /T


```tip
El comando **TAKEOWN** se utiliza para cambiar el dueÃ±o de un fichero o directorio. 
```

Para poder hacerlo deberemos ser usuarios administradores y estar usando una unidad con sistema de archivos **NTFS**

        TAKEOWN /F "D:\System Volume Information" 

## Resumen comandos

| **Operaciones (Acciones)**                | **Comando**                           |
|-------------------------------------------|---------------------------------------|
| Redireccionamientos                       | \> , \>\> , \<                        |
| Abrir el administrador de discos          | DISKMGMT                              |
| Limpiar disco                             | CLEANMGR                              |
| Reparar disco                             | CHKDSK                                |
| Comprobar integridad archivos del sistema | SFC                                   |
| InformaciÃ³n del sistema                   | WMIC                                  |
| Listado de procesos                       | TASKLIST                              |
| Cerrar un proceso                         | TASKKILL /PID                         |
| Listado de servicios                      | NET START                             |
| Gestor de usuarios                        | NETPLWIZ                              |
| Visualizar usuarios del sistema           | NET USER                              |
| Visualizar grupos del sistema             | NET LOCALGROUP                        |
| AÃ±adir/borrar usuario                     | NET USER nombre /ADD \| /DELETE       |
| AÃ±adir/borrar grupo                       | NET LOCALGROUP nombre /ADD \| /DELETE |
| GestiÃ³n de permisos                       | ICACLS                                |
