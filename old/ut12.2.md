# UT12.2 Administraci√≥n de Linux: usuarios y permisos

## Usuarios y grupos

Linux como sabemos es un sistema operativo **multiusuario**, caracter√≠stica que permite por tanto ser utilizado por m√∫ltiples usuarios al mismo tiempo, compartiendo procesador, memoria, almacenamiento, aplicaciones y perif√©ricos.

Para que m√∫ltiples usuarios puedan utilizar el sistema de forma segura y ordenada, es necesario que el sistema disponga de mecanismos de administraci√≥n y seguridad para la protecci√≥n de los datos de cada uno de los usuarios, as√≠ como herramientas que permitan su correcto funcionamiento.

Los usuarios del sistema pueden acceder a este de manera **local** y **remota**, siendo esta √∫ltima manera la m√°s com√∫n en este tipo de sistemas.

![](media/2945bf23dffaa708ae7083f7567a779c.png)

## Usuarios y grupos locales

```note
Cada usuario se identifica por un User ID o **UID** as√≠ como por su Group ID o **GID** asociado, que por defecto tiene su mismo nombre.
```

üí° En general, a los usuarios generados se les asigna un UID igual o superior a *1000*. Los comprendidos entre *0-100* quedan reservados a usuarios especiales del sistema.

Los diferentes **tipos de usuarios** en Linux:

-   **Root o superusuario** (\#) (**UID=0**): es el √∫nico que tiene privilegios sobre todo el sistema, y responsable de las tareas de administraci√≥n del sistema, tales como la instalaci√≥n y desinstalaci√≥n de software, entre otras muchas. Para cualquier acci√≥n que necesite permisos de superusuario, el sistema requerir√° credenciales root.
-   **Usuarios especiales de sistema**: van vinculados a ciertos servicios, y que pueden asumir ciertos privilegios relativos a este servicio. Se crean autom√°ticamente en la instalaci√≥n del sistema o de ciertas aplicaciones. Por ejemplo *mail, apache, syslog..*
-   **Usuarios est√°ndar** (\$)**:** Las cuentas de usuarios individuales con login. Puede haber tantas como se requiera. Cada usuario est√°ndar posee su directorio personal dentro de /home

Cada usuario tiene asociada una **cuenta de usuario** concreta (en este curso solo veremos las cuentas locales).

Dichas cuentas no solo ofrecen al usuario un nombre y una contrase√±a, tambi√©n le proporciona una ruta para almacenar sus documentos y su perfil, generalmente dentro de la carpeta **/home/nombre-usuario** y com√∫nmente denominada carpeta home del usuario, y un int√©rprete de comandos (**shell**) que le permitir√° ejecutar aplicaciones.

![](media/3b52d32c0cac8da6e12699158892fdd3.jpeg)

### Superusuario root

Como hemos comentado el usuario **root** (UID=0) en Linux es el usuario que posee mayor nivel de privilegios en el sistema. Es el √∫nico que tiene privilegios sobre todo el sistema, y el responsable de las tareas administrativas: instalaciones, modificaciones, configuraciones, etc.

![](media/93718c61f83a1616cab2a52ad35ba9ce.png)

Mediante el comando **sudo** en la l√≠nea de comandos se permite al usuario actual, ejecutar aplicaciones o procesos bajo los privilegios de root u otro usuario.

‚ùó Iniciar sesi√≥n de continuo como usuario root es una pr√°ctica poco recomendada (sudo su) ya que mantener abierta permanentemente una sesi√≥n de usuario root podr√≠a traer graves consecuencias e inutilizar el sistema.

### Ficheros importantes

La informaci√≥n sobre usuarios, grupos y contrase√±as se guarda en los archivos:

-   **/etc/passwd**: informaci√≥n sobre usuarios
-   **/etc/group**: informaci√≥n sobre grupos
-   **/etc/shadow**: contrase√±as cifradas

Dichos ficheros contiene diversos campos separados por dos puntos que estudiaremos a continuaci√≥n y se puede visualizar su contenido mediante **cat**.

![](media/fda584a405f0ead3249e195076c450c4.png)

Estructura del fichero **/etc/passwd** con el significado de cada para uno de sus <u>campos</u> separados por dos puntos:

![](media/44d18af1b97089ef06ccc10df3e2ea6f.png)

Estructura del fichero **/etc/shadow** con el significado de sus <u>campos</u>:

![](media/3c3e61a5d159c6f05f61cb8ff835c23f.png)

Estructura del fichero **/etc/group** con el significado de sus <u>campos</u>:

![](media/f530f0ae904737d5c38394e93b163978.png)

Para mostrar la informaci√≥n de duraci√≥n de contrase√±as de forma m√°s compresible que en el fichero **/etc/shadow** se puede usar el comando **chage ‚Äìl usuario**:

![](media/a58edc427d6b7405d127e5d38141d558.png)

### Privilegios de administrador

Es posible que un usuario est√°ndar necesite disponer de **privilegios de administrador** y poder realizar acciones como **sudo**.

Ello se puede llevar a cabo de dos formas:

1.  Editando el fichero **/etc/sudoers**.

    A√±adir el usuario al fichero, por lo que habr√≠a que a√±adir una l√≠nea como esta:

        Nombre_usuario ALL=(ALL:ALL) ALL

1.  Editando el fichero **/etc/group**

    Si, en el fichero */etc/sudoers* ya existe una l√≠nea referente al grupo *sudo* (o *admin)* como se debe incluir al usuario a uno u otro grupo como secundario editando el fichero */etc/group* (o agregarlo mediante usermod) a dichos grupos.

### Comandos de usuarios

Los comandos m√°s importantes para la gesti√≥n de **usuarios locales**:

| **Comando** | **Acci√≥n**                                          | **Ejemplo**                |
|-------------|-----------------------------------------------------|----------------------------|
| **useradd** | agregar usuarios                                    | useradd ‚Äìg users usuario   |
| **adduser** | agregar usuario mediante un script\*                | adduser usuario            |
| **usermod** | modificar usuarios                                  | usermod ‚Äìd /home/javi user |
| **userdel** | borrar usuarios                                     | userdel ‚Äìr usaurio         |
| **deluser** | borrar usuario mediante un script\*                 | deluser usuario            |
| **passwd**  | establecer contrase√±a a un usuario                  | passwd usuario             |
| **chage**   | visualizar o establecer duraci√≥n de contrase√±as     | chage ‚Äìl usuario           |
| **who**     | usuarios actualmente logueados.                     | who o w                    |
| **id**      | Muestra la identidad del usuario (UID) y sus grupos | id usuario                 |

üí° **adduser** y **deluser** utilizan un script m√°s elaborado para agregar o eliminar usuarios

### Agregar usuarios/grupos

```note
Para **agregar** un usuario de forma sencilla usaremos el comando **useradd.** 
```
Su sintaxis:

    useradd [opciones] [nombre_de_usuario]

Par√°metros:

    -d Especifica el directorio home del usuario
    -s Especifica el shell del usuario
    -g Especifica el grupo primario del usuario
    -G Especifica los grupos secundarios del usuario
    -uid Especifica el identificador de usuario para el usuario

üí° Despu√©s de crear un usuario con useradd conviene siempre recordar que hay que asignarle a continuaci√≥n contrase√±a con el comando **passwd.**

```tip
Para **agregar** grupos se utiliza **groupadd** 
```
Con la siguiente sintaxis:

    groupadd [opciones] [nombre_de_usuario] 
    
Par√°metros:

    -g GID Especifica ID para el grupo, el cual debe ser √∫nico y mayor que 499

### Modificar usuarios

```tip
Para **modificar** las propiedades de un usuario ya existente se utiliza **usermod** 
```
La sintaxis del comando:

    usermod [par√°metros] [nombre_de_usuario]

Par√°metros:

    -C Agrega un nuevo valor al campo de comentarios del usuario
    -d Especifica un nuevo directorio home para el usuario
    -g Cambiar el grupo primario del usuario
    -G Cambiar los grupos secundarios del usuario
    -s Cambiar el Shell por defecto del usuario
    -L Bloquea la contrase√±a del usuario
    -u Cambiar el UID asignado (siempre \> 1000)
    -e Fecha en la que estar√° deshabilitada la cuenta de usuario (formato AAAA-MM-DD)

### Gesti√≥n de contrase√±as

```tip
Para la **gesti√≥n de contrase√±as** se utiliza el comando **chage** 
```

La sintaxis del comando:

    chage [par√°metros] [usuario]

Par√°metros:

    -l Muestra informaci√≥n sobre la antig√ºedad de la cuenta
    -d Establece el √∫ltimo d√≠a que se cambi√≥ la contrase√±a. Si se pone valor 0 obligar√° al usuario a cambiar la contrase√±a en su pr√≥ximo acceso.
    -m Establece el n√∫mero m√≠nimo de d√≠as entre cambios de contrase√±a. Si se establece en un valor de 0, indica que el usuario puede cambiar su contrase√±a en cualquier momento.
    -M Establece el n√∫mero m√°ximo de d√≠as durante los cuales una contrase√±a es v√°lida.
    -E Establece una fecha concreta de caducidad de una cuenta escrita en formato AAAA-MM-DD

```tip
Para la modificaci√≥n de contrase√±as se utiliza el comando **passwd** 
```

Su sintaxis:

    passwd [par√°metros] [nombre_de_usuario]

Par√°metros:

    -a informa del estado de las contrase√±as de todas las cuentas
    -d | borra la contrase√±a para la cuenta indicada    
    -l | bloquea la contrase√±a de la cuenta indicada  
    -u | desbloquea la contrase√±a de la cuenta indicada 
    -w establece el aviso de caducidad a los d√≠as indicados
    -n establece el n√∫mero m√≠nimo de d√≠as antes de que se cambie la contrase√±a

### Uso de los comandos

üí° **useradd** es un comando que ejecuta un binario del sistema, mientras que **adduser** es un script en *perl* que utiliza el comando useradd. Es m√°s completo ya que crea el *home, pide contrase√±a* y hace verificaciones pero no est√° en todas las distribuciones. Igual con **deluser** que adem√°s elimina sus ficheros y directorios del home.

Crear al usuario con useradd es el primer paso, el segundo es asignarle una contrase√±a. Esto se logra con el comando **passwd**, que permite ingresar la contrase√±a y su verificaci√≥n. Para verificar el *id* del usuario y grupo usar **id**.

![](media/2c1a17617bc935413e2f5ee9de152119.png)
![](media/46bb56529a22e1841934df85f5e754d8.png)
![](media/0950f65c483b080fb97b2c33ebe4a581.png)

üí° **passwd** tiene varias opciones que permiten bloquear la cuenta -l, desbloquearla -u, y varias opciones m√°s que controlan la vigencia de la contrase√±a, es decir, es otro modo de establecer los valores de la cuenta en */etc/shadow*.

### Comandos de grupos

Los comandos m√°s importantes para la gesti√≥n de **grupos**:

| **Comando**  | **Acci√≥n**                                    | **Ejemplo**                 |
|--------------|-----------------------------------------------|-----------------------------|
| **groupadd** | crear un grupo                                | groupadd alumnos            |
| **groupmod** | modificar grupo                               | groupmod ‚Äìg 2000 profesores |
| **groupdel** | borrar grupo                                  | groupdel profesores         |
| **adduser**  | a√±adir usuario a un grupo                     | adduser juan profesores     |
| **deluser**  | eliminar usuario de un grupo                  | deluser juan profesores     |
| **groups**   | ver los grupos a los que pertenece un usuario | groups juan                 |



Todos los usuarios pertenecen al menos a un grupo que es el **grupo principal del usuario**, tambi√©n llamado grupo primario del usuario, pero pueden pertenecer a m√°s grupos. En caso de que pertenezcan a m√°s grupos, √©stos ser√°n **grupos secundarios**.

üí° El fichero de contrase√±as de usuarios es el */etc/gshadow*

Ubuntu dispone a su vez de una herramienta gr√°fica de administraci√≥n de usuarios que es **users-admin** (paquete *system-tools*). Para ejecutarla podemos abrir una consola de root y ejecutar users-admin o desde el men√∫ *configuraci√≥n\>cuentas de usuario*

![](media/34c30438eaea269393cd6029a9e2d464.jpeg)

## Permisos

```note
üí° Los permisos en Linux funcionan utilizando el mismo esquema que en Unix; se aplican sobre archivos o sobre directorios y van asociados a usuarios o grupos pudiendo ser de lectura, de escritura o de ejecuci√≥n.
```

Todos los archivos y directorios en Linux tienen asociado un conjunto de permisos que debe definir las posibilidades de lectura, escritura y ejecuci√≥n que se aplican al usuario propietario del archivo, al grupo de usuarios al que pertenece, y al resto del mundo.

Existen por tanto tres tipos de permisos **generales** en Linux ya conocidos:

-   Permiso de lectura **(r)**
-   Permiso de escritura **(w)**
-   Permiso de ejecuci√≥n **(x)**

En la siguiente tabla se muestran los permisos necesarios para ejecutar determinados <u>comandos conocidos</u>:

| **Comando** | **Permisos directorio** **origen** | **Permisos fichero** | **Permisos directorio** **destino** |
|-------------|------------------------------------|----------------------|-------------------------------------|
| cd          | x                                  | No aplicable         | No aplicable                        |
| ls          | r                                  | No aplicable         | No aplicable                        |
| mkdir       | w, x                               | No aplicable         | No aplicable                        |
| rmdir       | w, x                               | No aplicable         | No aplicable                        |
| cat         | x                                  | r                    | No aplicable                        |
| rm          | w, x                               |                      | No aplicable                        |
| cp          | x                                  | r                    | w, x                                |
| mv          | w, x                               |                      | w, x                                |

### Privilegios

De entrada, en cualquier fichero o directorio en Linux hay tres tipos o niveles de **privilegios** a los que van dirigidos los permisos anteriores:

-   **Permisos del Usuario (U).** Es el primer nivel de privilegios. B√°sicamente representa los permisos que se aplican al propietario de un determinado fichero o directorio.
-   **Permisos del Grupo (G)**. Estamos ante el segundo nivel de privilegios, que define los derechos de lectura, escritura y ejecuci√≥n que se aplican solo a aquellos usuarios que pertenecen al mismo grupo que el propietario del fichero.
-   **Permisos de Otros (O)**. Este es el √∫ltimo nivel. Representan los privilegios de lectura, escritura y ejecuci√≥n por parte del resto de usuarios que no entran en ninguno de los niveles anteriores.

### Representaci√≥n de permisos

![](media/761a0b919744b4df7d6f34d50fb27a91.png)

Cada archivo en Linux queda identificado por 10+1 caracteres mismos a los que se les denomina m√°scara. Se pueden mostrar mediante el comando **ls -l**

El significado de todos los **campos y permisos** en dicho comando ser√°:

![](media/19cd024f43e51c8502a4164a24d0f9a8.png)

El significado de los **permisos** var√≠a en caso de tratarse de un archivo o de un directorio, lo cual puede ser problem√°tico:

| **Permiso**   | **Aplicaci√≥n** | **Descripci√≥n**                                                                    |
|---------------|----------------|------------------------------------------------------------------------------------|
| Lectura (R)   | Archivo        | Lectura del contenido del archivo.                                                 |
| Lectura (R)   | Directorio     | Listar los archivos que est√°n contenidos en el directorio (ls).                    |
| Escritura (W) | Archivo        | Lectura y modificaci√≥n del contenido del archivo. Eliminaci√≥n del archivo.         |
| Escritura (W) | Directorio     | Eliminar carpeta. Crear subdirectorios dentro de ella.                             |
| Ejecuci√≥n (X) | Archivo        | Ejecuci√≥n de archivos binarios                                                     |
| Ejecuci√≥n (X) | Directorio     | Posicionarnos (cd). Acceso a propiedades y contenido de archivos y subdirectorios. |

Tambi√©n existe una representaci√≥n num√©rica en **octal**, que parte de idea de la representaci√≥n anterior, pero sustituye cada grupo **r w x** (y los especiales) por un valor **num√©rico que sumar** en caso de tener dicho <u>permiso</u>.

![](media/a9394608ea705fbf27e30e2b2fe5eff7.png)

La siguiente tabla muestra la forma de asignar permisos en ambas notaciones:

| **Permisos normales**    | **Valor octal** | **Notaci√≥n** **simb√≥lica** |
|--------------------------|-----------------|----------------------------|
| **Propietario**: Lectura | 400             | u+r                        |
| Escritura                | 200             | u+w                        |
| Ejecuci√≥n / Acceso       | 100             | u+x                        |
| **Grupo**: Lectura       | 40              | g+r                        |
| Escritura                | 20              | g+w                        |
| Ejecuci√≥n / Acceso       | 10              | g+x                        |
| **Otros**: Lectura       | 4               | o+r                        |
| Escritura                | 2               | o+w                        |
| Ejecuci√≥n / Acceso       | 1               | o+x                        |

### Modificaci√≥n de permisos

Habiendo entendido lo anterior, es ahora f√°cil cambiar los permisos de cualquier archivo o directorio, utilizando para ello el comando **chmod** (*change mode*), cuya sintaxis es la siguiente:

    chmod [par√°metros] permisos archivo

üí° El par√°metro **‚ÄìR** aplicar√° los permisos de forma recursiva a los subdirectorios.

Existen dos variantes para aplicar permisos, usando letras o los valores octales como veremos con ejemplos a continuaci√≥n:
-  **1¬™ Forma**: chmod [u,g,o][+,-][r,w,x] ruta-directorio
-  **2¬™ forma**: chmod [valor] ruta-directorio


#### 1¬™ Forma

Ejemplos:

- Dar permiso de escritura al usuario propietario sobre *'examen.txt'*: 

        chmod u+w examen.txt

- Quitar permiso de escritura al resto de usuarios sobre el archivo anterior:

        chmod o-w examen.txt

- Dar permiso de ejecuci√≥n al grupo propietario sobre <u> todos los archivos</u>: 

        chmod g+x *

- Dar permiso de lectura al grupo propietario sobre *'examen.txt'*:

        chmod g+r examen.txt

- Dar permiso de escritura al usuario y quitar el de lectura a grupos y otros: 

        chmod u+w, go-r

- Dar permisos de escritura a usuarios y grupos:

        chmod ug+w

#### 2¬™ Forma

- Dar todos los permisos al usuario y ninguno al grupo ni al resto del fichero *'examen.txt'*: 

        chmod 700 examen.txt

- Dar a usuario y grupo permisos de lectura y ejecuci√≥n, ninguno al resto: 

        chmod 550 examen.txt

- Dar todos los permisos al usuario as√≠ como lectura y ejecuci√≥n a los dem√°s:

        chmod 755 examen.txt

-  Dar todos los permisos al usuario y de lectura al resto, sobre todos los archivos de texto que contenga el directorio:

        chmod -R 744 *

-  Dar permisos completos a todos los usuarios al directorio /respaldo/

        chmod 777 /respaldo/ 

- Cambiar permisos a lectura y escritura a <u>todos los archivos incluyendo subdirectorios</u>:

        chmod -R 555


### M√°scaras

```note
Es importante saber que al crear un fichero o directorio, se crear√° por unos permisos por defecto llamados **m√°scara** que pueden visualizarse o modificarse a trav√©s del comando **umask.**
```

Normalmente el valor por defecto de **umask** suele ser **002**. Podemos averiguarlo simplemente ejecutando el comando *umask*.

üí° Los ficheros y directorios tienen definidos por defecto unos permisos base, **666** para los ficheros y **777** para los directorios.

Este ser√° por tanto el valor a restar usando el resultado de la **m√°scara** devuelto por **umask**:

- Por eso, al crear un fichero, su permiso inicial ser√° **664** (-rw-r‚Äìr‚Äì), valor resultante de realizar la operaci√≥n *666 -* **002**.
- Al crear un directorio, su permiso inicial ser√° **775** (drwxr-xr-x), resultado de *777 -* **002**.


![](media/4e95b078ec4025f7713c7cd5a896e696.jpeg)

### Modificaci√≥n de propietario

```tip
El comando **chown** (*change user*) permite cambiar el propietario de un archivo o directorio en sistemas tipo UNIX. 
```

Puede especificarse tanto el nombre de un usuario, as√≠ como el identificador de usuario (UID) y el identificador de grupo (GID).

Opcionalmente, utilizando un signo de dos puntos (:), o bien un punto (.), sin espacios entre ellos, entonces se cambia el **usuario y grupo** al que pertenece cada archivo. Con el par√°metro **‚ÄìR** se har√° el cambio de propietario de forma recursiva.

    chown [par√°metros] archivo

Ejemplos:

    # cambiar usuario propietario
    chown root tmpfile
    # cambiar grupo propietario
    chown :profesores tmpfile
    # cambiar usuario y grupo propietario
    chown root:profesores tmpfile


---


Comandos importantes para la gesti√≥n de **permisos**:

| **Comando** | **Acci√≥n**                               | **Ejemplo**             |
|-------------|------------------------------------------|-------------------------|
| **chmod**   | cambiar permisos fichero o directorio    | chmod 750 mifichero.txt |
| **chown**   | cambiar propietario fichero o directorio | chown root prueba.txt   |
| **chgrp**   | cambiar grupo fichero o directorio       | chgrp alumnos notas.doc |
| **umask**   | m√°scara de permisos por defecto          | umask 025               |

---


![](media/b4778cd160f5a79e4efc5c6b65e6b278.jpeg)

## Creaci√≥n de plantillas de usuarios

Las **plantillas de usuarios** permiten ahorrar tiempo en la creaci√≥n de usuarios cuando su n√∫mero aumenta. Son como moldes que poseen la configuraci√≥n b√°sica para crear a partir de ellos el resto de usuarios.

La creaci√≥n de plantillas de usuarios en Linux se basa en la utilizaci√≥n de:

-   **Archivos** que se copian en la creaci√≥n de un usuario para configurar su entorno personal. Estos archivos se configuran en el directorio /etc/skel/
-   **Par√°metros** que se dan por defecto a los usuarios en su creaci√≥n. Es decir, nosotros podemos especificar en la creaci√≥n los par√°metros de los usuarios, pero si no lo hici√©ramos estos ser√≠an tomados del archivo /etc/login.defs visto anteriormente.

Cuando se crea un **usuario**, el sistema realiza lo siguiente:

1.  Copia los archivos que se encuentran en el directorio /etc/skel en el directorio de inicio del nuevo usuario.
2.  Establece al usuario y al grupo del usuario que se est√° creando como propietario y grupo de estos archivos copiados.

Gracias a esto, cuando creamos los usuarios podemos controlar la apariencia de su escritorio, sus variables de entorno, sus alias y muchos otros par√°metros de su entorno.
